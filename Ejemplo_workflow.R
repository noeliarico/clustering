library(factoextra)
library(FactoMineR)
data("USArrests")
df <- scale(USArrests)
apply(df, 2, summary)

kmeans(df, 2, iter.max = 10, nstart = 1)
fviz_nbclust(df, kmeans, method = "wss") +
  geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")

fviz_pca_var(PCA(df,  graph = FALSE), col.var="contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE # Avoid text overlapping
)

fviz_pca_ind(PCA(df,  graph = FALSE), col.ind = "cos2",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE # Avoid text overlapping (slow if many points)
)


iris.pca <- PCA(iris[,-5], graph = FALSE)
# Visualize
# Use habillage to specify groups for coloring
fviz_pca_ind(iris.pca,
             label = "none", # hide individual labels
             habillage = iris$Species, # color by groups
             palette = c("#00AFBB", "#E7B800", "#FC4E07"),
             addEllipses = TRUE # Concentration ellipses
)

# 1. Loading and preparing data
data("USArrests")
df <- scale(USArrests)
# 2. Compute k-means
set.seed(123)
km.res <- kmeans(scale(USArrests), 4, nstart = 25)
# 3. Visualize
library("factoextra")
fviz_cluster(km.res, data = df,
             palette = c("#00AFBB","#2E9FDF", "#E7B800", "#FC4E07"),
             ggtheme = theme_minimal(),
             main = "Partitioning Clustering Plot"
)

# 1. Loading and preparing data

df <- scale(iris[,-5])
# 2. Compute k-means
set.seed(123)
km.res <- kmeans(scale(iris[,-5]), 3, nstart = 25)
# 3. Visualize
library("factoextra")
fviz_cluster(km.res, data = df,
             palette = c("#00AFBB","#2E9FDF", "#E7B800", "#FC4E07"),
             ggtheme = theme_minimal(),
             main = "Partitioning Clustering Plot"
)


find_hull <- function(iris) iris[chull(iris$Petal.Width, iris$Petal.Length), ]
hulls <- ddply(iris, "Species", find_hull)



iris %>% select(Petal.Width, Petal.Length, Species) %>% group_by(Species) %>% group_map(~ find_hull(., "Petal.Width", "Petal.Length"))

plot_real_clusters <- function(data, clusters, x, y) {
  hulls <- data %>% 
    group_by_at(clusters) %>% 
    group_modify(~ find_hull(., x, y)) %>%
    ungroup() %>%
    bind_rows()

  ggplot(data, aes_string(x = x, y = y,
                   color = clusters, fill = clusters)) +
    geom_point() +
    geom_polygon(data = hulls, alpha = 0.1) +
    theme_bw()
}

plot_real_clusters(iris, "Species", "Petal.Width", "Petal.Length")



find_hull <- function(iris) iris[chull(iris$Petal.Width, iris$Petal.Length), ]
hulls <- ddply(iris, "Species", find_hull)

#plot with hull
ggplot(iris,aes(x=mass,y=length,color=age))+geom_point()+
  geom_polygon(data=hulls,fill=NA)+ theme_bw()


library(cluster)
clusplot(wine.stand, k.means.fit$cluster, main='2D representation of the Cluster solution',
         color=TRUE, shade=TRUE,
         labels=2, lines=0)

# Compute k-means with k = 4
set.seed(123)
km.res <- kmeans(df, 4, nstart = 25)

# compute the mean of each variables
aggregate(USArrests, by=list(cluster=km.res$cluster), mean)

# add the point classi!cations to the original data
dd <- cbind(USArrests, cluster = km.res$cluster) 
head(dd)

x <- structure(c(3.37095844714667, 1.43530182860391, 2.36312841133734, 
                 2.63286260496104, 2.404268323141, 1.89387548390852, 3.51152199743894, 
                 1.9053409615869, 4.01842371387704, 1.93728590094758, 3.30486965422349, 
                 4.28664539270111, 0.611139298887661, 1.72121123318263, 1.86667866360634, 
                 2.63595039807007, 1.71574707858393, -0.656455420904776, -0.440466928575519, 
                 3.32011334573019, 1.69336140592153, 0.21869156602, 1.82808264424038, 
                 3.2146746991726, 3.89519346126497, 1.5695308683938, 1.74273061723107, 
                 0.23683691480522, 2.46009735483127, 1.36000512403988, 2.45545012324122, 
                 2.70483733722882, 3.03510352196992, 1.39107362459279, 2.50495512329797, 
                 0.282991320926657, 1.2155409916205, 1.14909240582348, -0.414207649946632, 
                 2.03612260689226, 2.20599860020025, 1.63894270145133, 2.75816323569952, 
                 1.27329517292342, 0.631718955580705, 2.43281802588872, 1.18860682381333, 
                 3.44410126172125, 1.56855379738665, 2.65564788340221, 2.32192526520395, 
                 1.21616105911962, 3.57572751979198, 2.64289930571732, 2.08976064659961, 
                 2.27655074729146, 2.67928881605527, 2.08983288657908, -0.993090083152935, 
                 2.28488295353066, 1.63276535725902, 2.18523056486561, 2.58182372736551, 
                 3.39973682729268, 1.27270794052553, 3.30254263204414, 2.33584811975207, 
                 3.03850609869762, 2.92072856829065, 2.72087816286686, 0.956881061432145, 
                 1.90981361338929, 2.62351816199954, 1.04647664222766, 1.45717118542614, 
                 2.58099649768168, 2.76817873783459, 2.46376758854017, 1.11422370259032, 
                 0.900219101352144, 3.51270700980493, 2.25792143753203, 2.08844022915959, 
                 1.87910346246091, 0.805671104839472, 2.61199689804039, 1.78286015425348, 
                 1.81724329366808, 2.93334632857116, 2.82177311050825, 3.39211637593427, 
                 1.52382607694533, 2.65034856072631, 3.39111045639, 0.889211120552101, 
                 1.13920741312216, 0.86826131914623, 0.540786000497604, 2.07998255324116, 
                 2.65320433964919, -3.79903462440151, -3.95524891283227, -6.00320864683985, 
                 -3.15151809832725, -5.66677340875782, -4.89448618754393, -5.42225588186886, 
                 -5.12235017195497, -4.8118069654985, -4.88083904200299, -5.0250925508674, 
                 -4.89192727205797, -5.48543523584667, -5.5042171306879, -6.66109907991481, 
                 -5.38233372687382, -5.5126502578778, -2.2981089996552, -6.36211623118972, 
                 -4.86274378144139, -6.49362506731629, -6.4704357414368, -4.87529761380299, 
                 -5.99663913488404, -5.00182261430471, -5.42825888142582, -5.6136716064495, 
                 -7.02467784541911, -6.22474795035999, -4.82048355888206, -4.43237940557646, 
                 -5.49287735355347, -4.99993711593465, -3.87711035662003, -3.56014425702381, 
                 -6.09711376840582, -5.11731956025018, -3.7985015990803, -5.4697295805663, 
                 -5.052469484939, -5.08610729823709, -5.88767901790643, -5.44468400488474, 
                 -5.02944487908824, -5.41386884905792, -3.8866139766318, -5.48099284165398, 
                 -5.43316903260073, -4.3031374234479, -6.05636841317091, -5.04069847515122, 
                 -6.55154482234759, -3.83283045076432, -5.27364570137408, -5.46784532467225, 
                 -6.23825232798621, -5.00776203377733, -5.80028217795166, -5.53349232995044, 
                 -3.71232475441541, -5.17552587024213, -6.07178238415068, -4.83679311753262, 
                 -5.36273841562795, -4.40998645201266, -3.56757807226901, -5.99269251110949, 
                 -4.54534970241972, -4.91510194132151, -4.10443441773546, -5.22977813894627, 
                 -4.16338093153939, -6.74505586133669, -3.31054107868663, -4.13522202148142, 
                 -5.15077598888575, -6.44900713013917, -4.35699129995802, -4.51680613618523, 
                 -5.00635562642139, -4.84854410713758, -5.5841089703498, -4.63119326736976, 
                 -4.70534566028048, -5.27925937334258, -6.33623665489315, -4.29925118155997, 
                 -4.44580337772597, -5.83630659280142, -6.59458816200624, -4.79504141941237, 
                 -5.34508797797289, -4.74738829663555, -6.29400246548455, -5.95917044438036, 
                 -3.9142251463201, -4.59622509528429, -4.4135124632807, -3.18477155384605, 
                 -4.87117857139762, -7.00092923773151, -4.66622280256643, -3.82867487264121, 
                 -2.9404607577007, -6.37686159824052, -6.15085556562711, -5.70582139476012, 
                 -6.05405578207719, -5.64574372314249, -5.1853779676765, -6.20122205073999, 
                 -2.96302783301685, -4.89222525511445, -5.08410810050558, -4.50438035839541, 
                 -4.96258481388203, -5.13208803695591, -3.5232125764479, -5.2170302100921, 
                 -6.28360220409223, -4.6143321095566, -5.35151287352909, -5.52179609335627, 
                 -6.06813120068717, -4.57163409673331, -5.174018234427, -4.48433227135197, 
                 -5.23436527730592, -5.65850342582177, -3.74976339592128, -5.2717637151114, 
                 -4.0520480041248, -6.20158243010894, -5.4661160963755, -5.26935139515318, 
                 -5.39096540813086, -3.65129298800829, -5.02276470129841, -4.75577414889655, 
                 -5.94237170786392, -5.72921727650957, -4.00193109144515, -3.74151833540444, 
                 -3.7511363111899, -6.38063704952533, -2.95003930636361, -3.98312717020046, 
                 -5.02671746413826, -4.29639222120174, -5.97138522915186, -0.0961562415588573, 
                 1.0490504509376, -0.19849585655778, 1.19001899855975, 2.29770589960467, 
                 -0.033873722964751, 0.261559245786936, 1.04656393945086, -0.0175961198261059, 
                 0.616716040113722, 1.8727554116714, 1.96954501397012, 1.38384666502709, 
                 -0.851555663067465, 0.946003263173834, 2.06477321433828, 1.8131950374116, 
                 0.809183525895718, -1.6999298085637, 1.06096663880112, 1.57375169748358, 
                 1.0458035797251, 1.15741254017588, 1.43156537286877, 0.603450263949788, 
                 2.30997822575155, 1.47039339987394, -0.242670270574602, 2.38157545638553, 
                 2.20445893700982, 1.82407396368188, -0.662629402185595, 0.430693656394519, 
                 1.63551381728953, 1.04372200757786, 1.34801230366131, 3.45959354887041, 
                 0.181619675600331, -1.11320011492914, 1.27369527243041, 0.312403158756588, 
                 1.44604105296187, 0.187615276209403, 3.21205548033514, 0.87629402842257, 
                 0.522664493969948, 0.833738508513392, 1.86256338362643, 1.09734048520282, 
                 -0.625616739211288, 1.99537923217354, 2.76024216766205, 2.03899091287256, 
                 2.73507214161444, 1.85352737300113, 1.94211266461872, 2.48236946610453, 
                 2.99294363677573, 0.753604501967958, 1.96651247515439, 1.92903781875, 
                 1.24107934626905, 0.965640639060847, 1.36926804602918, 2.586807720013, 
                 1.58367734381635, 1.21511219049468, 2.1634163194861, 0.76328576489065, 
                 3.04587377623667, 1.51540458378129, 2.18912881168067, 2.05100633157497, 
                 1.99975933111356, 3.80938204244287, 1.17467204289006, 3.14547045222799, 
                 2.03157318755324, 1.16479419469328, 1.93123635098349, 2.74677168701247, 
                 1.5744812656054, 1.22791776480654, 2.15276410674789, 2.9885968451788, 
                 1.92654166532783, 0.612973446440258, 0.693324095624637, 1.23160467492206, 
                 1.47289187462554, 1.97857293495838, 2.67049807099628, 1.56538296142759, 
                 0.886120216687153, 2.6071059948785, 2.27545696873959, 3.15734706941474, 
                 0.317519140521744, 2.08731908889487, 3.35336189394267, 2.72417380068337, 
                 1.16744717423579, 2.73252848676841, 1.12807313000279, 1.54660248877021, 
                 3.18753427862908, 1.70985468820992, 2.82854614496544, 1.70877229122083, 
                 0.423637595252094, 1.15118430305108, 0.911480138042805, 1.51570942888283, 
                 1.66368879099043, 1.84664210933836, 1.75675277142515, 3.89220204160011, 
                 0.61400166271458, 1.58517569929222, 2.34908152810683, 3.62844226581541, 
                 2.08852189571362, 3.23915070840056, 0.355444464246293, 3.44635652537848, 
                 1.30943982833482, 1.72356891454615, 0.890581240100563, 2.13386931642945, 
                 3.78533905173155, 4.42216335525159, 0.923171097881588, 2.4859411104031, 
                 3.38852173874429, 1.80434318271546, 1.78182520229379, 1.69522204545355, 
                 2.59783272411144, 3.39742941081576, 2.68761976123996, 2.32018801429697, 
                 1.69813007422274, 2.49834868555795, 1.45046308208324, 1.72074349636276, 
                 3.09651344311173, 2.44201308817881, 2.24101629402611, 1.74439234464448, 
                 2.93103290148488, 3.33491258537547, 1.13072823612456, 2.0554869546651, 
                 2.04906691319192, 1.4216442716391, 1.001261344004, 1.9975672199934, 
                 2.65551188281297, 3.47684227897655, 0.0908472117207864, 1.29756052668759, 
                 1.68856978198808, 0.336842969332624, 1.24946655820771, 1.22264824081849, 
                 1.2774303001404, -0.188834599147068, 2.21341855028655, 1.36807706374517, 
                 3.52049119383216, 2.79595594941508, 0.546470434867201, 2.09839542100584, 
                 1.40622901576685, 2.88828116863451, 2.05307041549867, 1.44297637415534, 
                 2.43839703617272, 2.15260815864242, 1.83538241825044, 4.01989062147597, 
                 1.47061411368274, 1.52921302701596, 0.454063075982477, 1.95947327670482, 
                 2.89035630547068, -0.0713878509292138, 1.74993487992698, 0.818349573346682, 
                 3.44193726501691, 3.35789553887886, 2.33450284734065, 3.42933808040023, 
                 1.13268214912132, 2.95065172497189, 1.41498849136677, 2.32095752252563, 
                 1.70060398333509, 1.72145691670693, 2.54611515832953, 0.696178846355128, 
                 1.74908553495754, 2.17100737371791, 1.59653252125249, 2.10465944083573, 
                 1.68111921326599, 3.61834393588343, 2.71418860148862, 4.96586536983324, 
                 1.20492239544079, 2.81436591467991, 4.09803081013037, 2.30098005515257, 
                 0.916924858160769, 0.993677498196715, 1.96458543508239, 3.30912436085341, 
                 2.75040048664672, -0.13836832761242, 1.29964589113337, 1.99094352470701, 
                 0.541866512755232, 2.69452964649487, -0.461335475186488, 2.14328976404046, 
                 1.60877788087294, 1.50883591438592, 1.71635254754795, 2.31479480470784, 
                 2.39632657793899, 1.77439628896404, 0.0750495696594404, 0.560770701678021, 
                 0.530342226027598, 2.76186344689193, 1.75638501812872, 2.26967660741801, 
                 0.441072479044184, 1.46441199330369, 2.5624519731735, 1.82167387658008, 
                 1.88486401379735, 1.92793852789363, 3.2109098069263, 1.3851030992003, 
                 2.6761264583147, 2.89859960553755, 0.81068209647898, 2.12125884981901, 
                 1.98877831386959, 3.02914071931376, 2.91477486771961, 1.99754373332044, 
                 2.13600955241373, 1.27984645505688, 1.80187566994878, 0.970791193951727, 
                 1.03304410414738, 0.779186911080905, 2.83620770394484, 3.1149717984954, 
                 1.58705514707291, 0.871022601993169, 1.91206866822295, 4.24190369331262, 
                 4.04131317075049, 0.280199663278548, 1.64309334387761, 3.53328049216229, 
                 1.96175590338976, 3.59741324232643, 1.66641460669012, 2.60498592391538, 
                 2.22424123925025, 5.22906949548006, 2.92045256677252, 0.793460930784079, 
                 1.39611883083673, 2.37023528462206, 0.0989993533203934, 0.195590055036758, 
                 0.878177393644781, 1.65207039344086, 3.23890214863198, 1.72580243514772, 
                 2.16238071555819, 1.93539309024694, 1.29476290297486, 3.36219726875099, 
                 0.903486811916683, 1.77156648145311, 1.65217191938973, 2.53212861950673, 
                 3.60723456226119, 2.51381452611659, 3.38237316057303, 2.7630970485499, 
                 1.37541545536589, 2.08154380042899, 3.37607911136477, -1.56126578615704, 
                 0.324770660594699, -0.156790316952238, 0.877783860734352, 0.750166575180638, 
                 0.30105340384283, 1.49281111722931, -1.5254938001697, 0.910717558486022, 
                 -1.57953202785754, 0.587716257118581, 0.0896422960007244, 0.96726165694984, 
                 0.0788123529148234, -1.56869983648609, -2.00782318401609, 0.540973524238763, 
                 -0.0733765981084255, -0.571018393558081, -0.311068459853641, 
                 -0.671415067101365, -0.157340452080979, -0.931305070999869, -1.98300947947013, 
                 -0.219599804249378, 1.04527586946239, 1.87732956629967, 0.00260619595716637, 
                 -0.0806699347091655, 0.96298228123987, 0.0535710165465174, -0.434898408910037, 
                 -1.73729725534231, -1.26369559978243, 0.406308512069273, -1.45965396777976, 
                 1.0484573701547, -1.3464305394502, -0.193570558113494, -0.00233595711367605, 
                 -0.0128297338671881, 0.151947321984398, 0.598511131401079, -0.126212437298279, 
                 -0.248535565846776, 0.160327394904622, -0.433641941597269, 1.53741241910027, 
                 -2.17024657661608, 1.02700461929143), .Dim = c(300L, 2L))


# Initialize total within sum of squares error: wss
wss <- 0

# For 1 to 15 cluster centers
for (i in 1:15) {
  km.out <- kmeans(x, centers = i, nstart = 20)
  # Save total within sum of squares to wss variable
  wss[i] <- km.out$tot.withinss
}

# Plot total within sum of squares vs. number of clusters
plot(1:15, wss, type = "b", 
     xlab = "Number of Clusters", 
     ylab = "Within groups sum of squares")



# Set k equal to the number of clusters corresponding to the elbow location
k <- 2
